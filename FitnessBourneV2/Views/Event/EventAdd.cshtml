@model FitnessBourneV2.Models.EventAddModel

@{
    ViewBag.Title = "EventAdd";
}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.css" />
<!--<link rel="stylesheet" href="~/Content/leaflet.css" />-->
<link rel="stylesheet" href="~/Content/leaflet-routing-machine.css" />
<link rel="stylesheet" href="~/Content/index_route.css" />

  <!-- Load Esri Leaflet from CDN -->
<script src="https://unpkg.com/esri-leaflet@2.2.3/dist/esri-leaflet.js"
        integrity="sha512-YZ6b5bXRVwipfqul5krehD9qlbJzc6KOGXYsDjU9HHXW2gK57xmWl2gU6nAegiErAqFXhygKIsWPKbjLPXVb2g=="
        crossorigin=""></script>


<!-- Load Esri Leaflet Geocoder from CDN -->
<link rel="stylesheet" href="https://unpkg.com/esri-leaflet-geocoder@2.2.13/dist/esri-leaflet-geocoder.css"
      integrity="sha512-v5YmWLm8KqAAmg5808pETiccEohtt8rPVMGQ1jA6jqkWVydV5Cuz3nJ9fQ7ittSxvuqsvI9RSGfVoKPaAJZ/AQ=="
      crossorigin="">
<script src="https://unpkg.com/esri-leaflet-geocoder@2.2.13/dist/esri-leaflet-geocoder.js"
        integrity="sha512-zdT4Pc2tIrc6uoYly2Wp8jh6EPEWaveqqD3sT0lf5yei19BC1WulGuh5CesB0ldBKZieKGD7Qyf/G0jdSe016A=="
        crossorigin=""></script>

@using (Html.BeginForm("EventSave", "Event", FormMethod.Post, new { @class = "form-horizontal formPos", role = "form" }))
{

    @Html.ValidationSummary("", new { @class = "text-danger" })
    <div class="form-group">
        @Html.LabelFor(m => m.eventTypeName, new { @class = "col-md-2 control-label" })
        <div class="col-md-10">
            @{
                List<SelectListItem> listItems = new List<SelectListItem>();

                foreach (var item in Model.eventType)
                {
                    listItems.Add(new SelectListItem
                    {
                        Text = item.ET_Name,
                        Value = item.ET_Id.ToString()
                    });
                }

            }
            @Html.DropDownListFor(m => m.eventTypeName, listItems, new { @class = "form-control dropdown" })
        </div>
    </div>
    <div class="form-group">
        @Html.LabelFor(m => m.startDateTime, new { @class = "col-md-2 control-label" })
        <div class="col-md-3">
            <div class='input-group date datetimepickerclass' id='datetimepickerStart'>
                @Html.TextBoxFor(m => m.startDateTime, new { @class = "form-control" })
                <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
            </div>
        </div>
    </div>
    <div class="form-group">
        @Html.LabelFor(m => m.endDateTime, new { @class = "col-md-2 control-label" })
        <div class="col-md-3">
            <div class='input-group date datetimepickerclass' id='datetimepickerEnd'>
                @Html.TextBoxFor(m => m.endDateTime, new { @class = "form-control" })
                <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                </span>
            </div>
        </div>
    </div>
    <div class="form-group">
        <div class="col-md-10 col-md-offset-2">
            <label>@Html.CheckBoxFor(m => m.isPrivate, new { id = "privateCheck" })&nbsp;Is the event private to your club members?</label>
        </div>
    </div>
    <div class="form-group">
        @Html.LabelFor(m => m.mem_capacity, new { @class = "col-md-2 control-label" })
        <div class="col-md-10">
            @Html.DropDownListFor(m => m.mem_capacity, new List<SelectListItem>
{
new SelectListItem{ Text="1", Value = "1" },
new SelectListItem{ Text="2", Value = "2" },
new SelectListItem{ Text="3", Value = "3" },
new SelectListItem{ Text="4", Value = "4" },
new SelectListItem{ Text="5", Value = "5" },
new SelectListItem{ Text="6", Value = "6" },
new SelectListItem{ Text="7", Value = "7" },
new SelectListItem{ Text="8", Value = "8" },
new SelectListItem{ Text="9", Value = "9" },
new SelectListItem{ Text="10", Value = "10" },
new SelectListItem{ Text="11", Value = "11" },
new SelectListItem{ Text="12", Value = "12" },
new SelectListItem{ Text="13", Value = "13" },
new SelectListItem{ Text="14", Value = "14" },
new SelectListItem{ Text="15", Value = "15" }
}, new { @class = "form-control" })
        </div>
    </div>

    <div class="form-group">
        <div class="col-md-offset-2 col-md-10">
            <input type="button" class="btn btn-default" onclick="setEdit()" value="Add Event" />
        </div>
    </div>
}

<div class="form-group">
    @Html.LabelFor(m => m.Location1, new { @class = "col-md-2 control-label" })
    <div class="col-md-10">
        <div id="mapRoute" class="mapRouteClass"></div>
    </div>
</div>
<script>

    $(function () {
        $('#datetimepickerStart').datetimepicker({
            format: 'YYYY-MM-DD HH:mm'
        });

        $('#datetimepickerEnd').datetimepicker({
            format: 'YYYY-MM-DD HH:mm'
        });
    });

    function setEdit() {

        var locationList = [];

        $('.leaflet-control-container input').each(function () {

            if (this.value != "") {
                locationList.push(this.value);
            }
        });

        var errorDispString = "Provide both start and end location to register the event";

        if (locationList.length < 2) {

            // Start and End location required
            alert(errorDispString)
        } else {

            $.ajax({
                type: "POST",
                url: '@Url.Action("setLocation", "Event")',
                data: { "anchorName": locationList },
                success: function (response) {
                    document.getElementById("mainForm").submit();
                },
                error: function () {

                    alert("Error in contacting server!");

                }
            });
        }

    }


</script>
<script src="https://unpkg.com/leaflet@1.0.0-rc.3/dist/leaflet.js"></script>
<!--<script src="~/Scripts/leaflet.js"></script>-->
<script src="~/Scripts/leaflet-routing-machine.js"></script>
<script src="~/Scripts/Control.Geocoder.js"></script>
<script src="~/Scripts/config.js"></script>
<script src="~/Scripts/index_route.js"></script>



